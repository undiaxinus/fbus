name = "fbus-website"
compatibility_date = "2024-01-01"

[build]
command = "npm run build"

[site]
bucket = "./dist/fbus-web/browser"

[env.production]
name = "fbus-website"

# Handle all routes for Angular's client-side routing
[[redirects]]
from = "/*"
to = "/index.html"
status = 200

# Configure headers for security and cross-browser compatibility
[[headers]]
for = "/*"
[headers.values]
Access-Control-Allow-Origin = "*"
Access-Control-Allow-Methods = "GET, POST, PUT, DELETE, OPTIONS"
Access-Control-Allow-Headers = "*"
Content-Security-Policy = """
  default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https:;
  script-src 'self' 'unsafe-inline' 'unsafe-eval' https:;
  style-src 'self' 'unsafe-inline' https:;
  img-src 'self' data: https: blob:;
  font-src 'self' data: https:;
  connect-src 'self' https: wss:;
  media-src 'self' https: blob:;
  object-src 'none';
  frame-ancestors 'none';
"""
X-Content-Type-Options = "nosniff"
X-Frame-Options = "DENY"
X-XSS-Protection = "1; mode=block"
Referrer-Policy = "strict-origin-when-cross-origin"
Permissions-Policy = "accelerometer=(), camera=(), geolocation=(), gyroscope=(), magnetometer=(), microphone=(), payment=(), usb=()"
Strict-Transport-Security = "max-age=31536000; includeSubDomains"

# Proper MIME type handling
[[headers]]
for = "/*.js"
[headers.values]
Content-Type = "application/javascript; charset=utf-8"

[[headers]]
for = "/*.css"
[headers.values]
Content-Type = "text/css; charset=utf-8"

[[headers]]
for = "/*.html"
[headers.values]
Content-Type = "text/html; charset=utf-8"
Cache-Control = "no-cache, no-store, must-revalidate"

# Font files
[[headers]]
for = "/assets/fonts/*"
[headers.values]
Cache-Control = "public, max-age=31536000, immutable"
Access-Control-Allow-Origin = "*"

# Image files
[[headers]]
for = "/assets/images/*"
[headers.values]
Cache-Control = "public, max-age=31536000, immutable"
Access-Control-Allow-Origin = "*"

# Service worker
[[headers]]
for = "/service-worker.js"
[headers.values]
Cache-Control = "no-cache, no-store, must-revalidate"
Service-Worker-Allowed = "/" 